---
applyTo: "**/*.md,variables.tf,outputs.tf"
---

# Terraform Module Documentation Instructions

## Quick Reference

**When documenting modules:**
- Every variable needs a clear, specific description
- Every output needs a description explaining usage
- README must have: Module name, Examples (minimal + advanced), Configuration section
- Use terraform-docs markers: `<!-- BEGIN_TF_DOCS -->` / `<!-- END_TF_DOCS -->`
- Placeholders: `<VALUE>` for user input, `{{VALUE}}` for templates
- For examples → see [examples.instructions.md](./examples.instructions.md)
- For Terraform code style → see [terraform.instructions.md](./terraform.instructions.md)
- Visual diagrams → Use the **mermaid-diagrams** skill for flowcharts, architecture diagrams, and workflows

---

## Overview

Terraform module documentation consists of:
1. **README.md** - Main module documentation with examples and auto-generated reference
2. **Variable descriptions** in `variables.tf` - Used by terraform-docs for input documentation
3. **Output descriptions** in `outputs.tf` - Used by terraform-docs for output documentation
4. **Examples** (optional) - Working examples demonstrating module usage

## README.md Structure

### Required Sections

Every module README must include these sections in order:

```markdown
# module-name

Brief one-line description of what the module does

## Examples

[Usage examples here]

## Configuration

<!-- BEGIN_TF_DOCS -->
[Auto-generated documentation by terraform-docs]
<!-- END_TF_DOCS -->
```

### Module Name and Description

**Format:** `# terraform-{provider}-{resource-name}`

**Examples:**
- `# terraform-aws-ecs-service`
- `# terraform-aws-load-balancer`
- `# terraform-aws-service-secrets`

**Description Guidelines:**
- Keep it to one or two sentences
- Clearly state the module's primary purpose
- Mention if it follows specific standards (e.g., "following Luscii standards")
- Focus on what problem it solves

**Good Examples:**
- "Create a ECS (fargate) service following Luscii standards"
- "Module to handle secrets for AWS (ECS) services"
- "Terraform module for creating and managing AWS Application Load Balancers"

**Bad Examples:**
- "This is a module" (too vague)
- "Manages various AWS resources" (not specific enough)
- Long multi-paragraph descriptions (too detailed for the header)

### Examples Section

**See [examples.instructions.md](./examples.instructions.md) for comprehensive guidance on creating examples.**

The Examples section must include:

1. **Minimal Setup** - Basic example with required variables only
2. **Extended/Advanced Setup** - Production-ready example with common features
3. **Scenario-specific Examples** (optional) - Additional use cases

**Quick Guidelines:**
- Use realistic, working code
- Show integration with other resources
- Use angle brackets for placeholders: `<VPC_ID>`, `<REGION>`
- Demonstrate output usage
- Keep inline examples concise (under 100 lines for advanced)

**Reference to Examples Directory:**

For complex modules with multiple use cases, create an `examples/` directory with separate, runnable configurations. See [examples.instructions.md](./examples.instructions.md) for detailed structure and requirements.

### Configuration Section

The Configuration section is auto-generated by terraform-docs.

**Setup:**

1. Add terraform-docs markers:
   ```markdown
   ## Configuration

   <!-- BEGIN_TF_DOCS -->
   <!-- END_TF_DOCS -->
   ```

2. Configure `.terraform-docs.yml`:
   ```yaml
   formatter: markdown

   version: 0.20.0

   output:
     file: "README.md"
     mode: inject

   output-values:
     enabled: false

   sort:
     enabled: true
     by: name

   settings:
     anchor: true
     color: true
     default: true
     description: false
     escape: true
     hide-empty: false
     html: true
     indent: 3
     lockfile: true
     read-comments: true
     required: true
     sensitive: true
     type: true
   ```

3. Run terraform-docs:
   ```bash
   terraform-docs markdown . --output-file README.md
   ```

**What Gets Generated:**
- Requirements table (Terraform and provider versions)
- Providers table (with actual versions from lock file)
- Modules table (external modules used)
- Resources table (with links to Terraform registry)
- Data sources table
- Inputs table (from variable descriptions)
- Outputs table (from output descriptions)

## Variable Documentation

Variable descriptions in `variables.tf` become the input documentation.

### Description Best Practices

**Be Specific and Clear:**
```terraform
# Good
variable "task_cpu" {
  type        = number
  description = "value in cpu units for the task"
}

# Bad
variable "task_cpu" {
  type        = number
  description = "CPU"
}
```

**Explain Purpose and Usage:**
```terraform
variable "enable_access_logs" {
  type        = bool
  description = "Whether to enable writing access logs to the configured S3 bucket. Only when `create_access_logs_bucket` is true, or `access_logs_bucket_name` is set."
  default     = false
}
```

**Document Complex Types:**
```terraform
variable "secrets" {
  type = map(object({
    value          = optional(string)
    description    = optional(string)
    value_from_arn = optional(string)
  }))
  sensitive   = true
  description = "Map of secrets, each key will be the name. When the value is set, a secret is created. Otherwise the arn of existing secret is added to the outputs."
  default     = {}
}
```

**Use Heredoc for Multi-line Descriptions:**
```terraform
variable "context" {
  type = any
  description = <<-EOT
    Single object for setting entire context at once.
    See description of individual variables for details.
    Leave string and numeric variables as `null` to use default value.
    Individual variable settings (non-null) override settings in context object,
    except for attributes, tags, and additional_tag_map, which are merged.
  EOT
}
```

**Reference External Documentation:**
```terraform
variable "scaling_target" {
  type = map(object({
    predefined_metric_type = string
    resource_label         = optional(string)
    target_value           = number
  }))
  description = "Target tracking scaling policies. Predefined metric type must be one of ECSServiceAverageCPUUtilization, ALBRequestCountPerTarget or ECSServiceAverageMemoryUtilization - https://docs.aws.amazon.com/autoscaling/application/APIReference/API_PredefinedMetricSpecification.html"
  default     = null
}
```

**Document Relationships:**
```terraform
variable "access_logs_bucket_name" {
  type        = string
  description = "Name of existing S3 bucket for access logs. Enables access logs for the load balancer, but does not create the bucket. If `create_access_logs_bucket` is true, this variable is ignored."
  default     = null
}
```

### Description Style Guide

1. **Capitalization:**
   - Start with a capital letter for complete sentences
   - Use lowercase for sentence fragments
   - Be consistent within your module

2. **Punctuation:**
   - End complete sentences with periods
   - Omit periods for fragments
   - Use backticks for variable names and values

3. **Tense:**
   - Use present tense: "Enables access logs" not "Will enable access logs"
   - Use active voice when possible

4. **Length:**
   - Keep single-line descriptions concise (under 100 characters when possible)
   - Use heredoc (<<-EOT) for longer explanations
   - Break complex descriptions into bullet points

## Output Documentation

Output descriptions in `outputs.tf` become the output documentation.

### Description Best Practices

**Describe What is Returned:**
```terraform
# Good
output "service_arn" {
  value       = aws_ecs_service.this.id
  description = "The ARN of the service"
}

# Bad
output "service_arn" {
  value       = aws_ecs_service.this.id
  description = "Service ARN"
}
```

**Explain Usage Context:**
```terraform
output "secret_arns" {
  value       = local.secret_arns
  description = "List of ARNs of the secrets - to use in IAM policies"
}
```

**Document Data Structure:**
```terraform
output "secrets" {
  value = {
    for key, secret in local.secrets : key => {
      arn         = secret.arn
      id          = secret.id
      name        = secret.name
      description = secret.description
    }
  }
  description = "Map of secrets, each key is the name, the value is the secret resource metadata (excluding secret values)"
}
```

**Indicate Integration Points:**
```terraform
output "container_definition" {
  value       = local.container_definitions
  description = "List of secrets and SSM Parameter maps in the format: { name = <name>, valueFrom = <arn> } - to use in container definitions"
}

output "iam_policy_document" {
  value       = try(data.aws_iam_policy_document.access[0].json, null)
  description = "IAM policy document containing permissions for accessing the defined secrets and SSM parameters - to use in the Task Execution role"
}
```

**Link to External Documentation:**
```terraform
output "scaling_target" {
  value       = local.scaling_enabled ? aws_appautoscaling_target.this[0] : null
  description = "The autoscaling target resource - https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/appautoscaling_target"
}
```

### Output Description Patterns

**Resource Identifiers:**
- "The ARN of the {resource}"
- "The ID of the {resource}"
- "The name of the {resource}"

**Collections:**
- "List of ARNs of the {resources}"
- "Map of {resources}, each key is..."

**Computed Values:**
- "Base URL for the service internally"
- "Fully qualified domain name for..."

**For External Use:**
- "... - to use in IAM policies"
- "... - to use in container definitions"
- "... - for subsequent use"

## Documentation Maintenance

### Pre-commit Hooks

Ensure documentation stays up-to-date:

```yaml
# .pre-commit-config.yaml
repos:
  - repo: https://github.com/terraform-docs/terraform-docs
    rev: v0.19.0
    hooks:
      - id: terraform-docs-go
        args: ["markdown", ".", "--output-file", "README.md"]
```

### Review Checklist

Before committing, verify:

- [ ] Module description is clear and concise
- [ ] Minimal and advanced examples are provided in README.md
- [ ] All variables have descriptions
- [ ] Complex variable types are well-documented
- [ ] All outputs have descriptions
- [ ] Output descriptions explain usage context
- [ ] terraform-docs markers are present
- [ ] `.terraform-docs.yml` is configured
- [ ] Documentation has been regenerated
- [ ] Examples are tested and working (see [examples.instructions.md](./examples.instructions.md))
- [ ] External links are valid and relevant

### Common Mistakes to Avoid

1. **Missing terraform-docs markers** - Always include `<!-- BEGIN_TF_DOCS -->` and `<!-- END_TF_DOCS -->`
2. **Empty descriptions** - Every variable and output must have a description
3. **Vague descriptions** - "Configuration for X" doesn't explain what or how
4. **Outdated examples** - Examples must match current variable names and types
5. **Missing context** - Explain relationships between variables
6. **No usage examples** - Show how outputs integrate with other resources
7. **Inconsistent formatting** - Follow the established patterns
8. **Manual documentation** - Use terraform-docs for the reference section

## Writing Style

### Tone
- Professional but approachable
- Clear and concise
- Technically accurate
- Helpful and informative

### Audience
- Assume readers know Terraform basics
- Explain module-specific concepts
- Provide context for AWS-specific features
- Link to AWS documentation for detailed explanations

### Formatting
- Use code blocks for all Terraform code
- Use backticks for inline code, variable names, and values
- Use **bold** for emphasis
- Use bullet points for lists
- Use numbered lists for sequential steps
- Keep paragraphs short and focused

## Quality Standards

Good documentation should:

1. **Be Discoverable** - Easy to find what you need
2. **Be Accurate** - Always match the current code
3. **Be Complete** - Cover all features and use cases
4. **Be Clear** - Understandable by the target audience
5. **Be Maintainable** - Easy to update as the module evolves
6. **Be Consistent** - Follow established patterns and conventions
